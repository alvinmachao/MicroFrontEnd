{"version":3,"file":"tinySingleSpa.js","sources":["../src/applications/app.helper.js","../src/navigation/hijackLocation.js","../src/applications/app.js","../src/applications/timeout.js","../src/lifecyles/helper.js","../src/lifecyles/load.js","../src/lifecyles/unmount.js","../src/lifecyles/bootstrap.js","../src/lifecyles/mount.js","../src/navigation/index.js","../src/start.js"],"sourcesContent":["export const NOT_LOADED = \"NOT_LOADED\";\nexport const LOAD_SOURCE_CODE = \"LOAD_SOURCE_CODE\";\nexport const NOT_BOOTSTRAPED = \"NOT_BOOTSTRAPED\";\nexport const BOOTSTRAPPING = \"BOOTSTRAPPING\";\nexport const NOT_MOUNTED = \"NOT_MOUNTED\";\nexport const MOUNTTING = \"MOUNTTING\";\nexport const MOUNTED = \"MOUNTED\";\nexport const UNMOUNTTING = \"UNMOUNTTING\";\nexport const UPDATEING = \"UPDATEING\";\nexport const SKIP_BECAUSE_BROKEN = \"SKIP_BECAUSE_BROKEN\";\nexport const LOAD_ERROR = \"LOAD_ERROR\";\nexport const notBroken = function (app) {\n  return app.status !== SKIP_BECAUSE_BROKEN;\n};\nexport const notLoadError = function (app) {\n  return app.status !== LOAD_ERROR;\n};\nexport const isloaded = function (app) {\n  return (\n    app.status !== LOAD_ERROR &&\n    app.status !== NOT_LOADED &&\n    app.status !== LOAD_SOURCE_CODE\n  );\n};\nexport const isnotLoad = function (app) {\n  return !isloaded(app);\n};\nexport const shouldBeActive = function (app) {\n  try {\n    return app.activityWhen(window.location);\n  } catch (error) {\n    app.status = SKIP_BECAUSE_BROKEN;\n    console.log(error);\n  }\n};\nexport const shouldnotBeActive = function (app) {\n  try {\n    return !app.activityWhen(window.location);\n  } catch (error) {\n    app.status = SKIP_BECAUSE_BROKEN;\n    console.log(error);\n  }\n};\n\nexport const isActive = function (app) {\n  return app.status === MOUNTED;\n};\nexport const isnotActive = function (app) {\n  return !isActive(app);\n};\n","import { invoke } from \"./index\";\nconst HIJACK_EVENTS_NAME = /^(popstate|hashchange)$/i;\nconst EVENTPOOL = {\n  popstate: [],\n  hashchange: [],\n};\nexport const reroute = function () {\n  invoke([], arguments);\n};\n\nwindow.addEventListener(\"popstate\", reroute);\nwindow.addEventListener(\"hashchange\", reroute);\nconst originAddEventListener = window.addEventListener;\nconst originRemoveEventListener = window.removeEventListener;\nwindow.addEventListener = function (type, handler) {\n  if (type && HIJACK_EVENTS_NAME.test(type) && typeof handler === \"function\") {\n    EVENTPOOL[type].indexof(handler) === -1 && EVENTPOOL[type].push(handler);\n  } else {\n    originAddEventListener.apply(this, arguments);\n  }\n};\nwindow.removeEventListener = function (type, handler) {\n  if (type && HIJACK_EVENTS_NAME.test(type) && typeof handler === \"function\") {\n    let list = EVENTPOOL[type];\n    EVENTPOOL[type] =\n      list.indexof(handler) > -1\n        ? list.filter((han) => han !== handler)\n        : EVENTPOOL[type];\n  } else {\n    originRemoveEventListener.apply(this, arguments);\n  }\n};\nlet originPushState = window.history.pushState;\nlet originReplacestate = window.history.replaceState;\nwindow.history.pushState = function (state, title, url) {\n  let result = originPushState.apply(this, arguments);\n  reroute(mockPopStateEvent(state));\n  return result;\n};\nwindow.history.replaceState = function (state, title, url) {\n  let result = originReplacestate.apply(this, arguments);\n  reroute(mockPopStateEvent(state));\n  return result;\n};\n\nfunction mockPopStateEvent(state) {\n  return new PopStateEvent(\"popstate\", { state });\n}\n\nexport function callCapturedEvents(events) {\n  if (!events) {\n    return;\n  }\n  if (Array.isArray(events)) {\n    events = events[0];\n  }\n  let name = events.type;\n  if (!HIJACK_EVENTS_NAME.test(name)) {\n    return;\n  }\n  EVENTPOOL[name].forEach((handler) => handler.apply(window, eventArgs));\n}\n","import {\n  NOT_LOADED,\n  notBroken,\n  notLoadError,\n  isnotLoad,\n  shouldBeActive,\n  isloaded,\n  isActive,\n  isnotActive,\n  shouldnotBeActive,\n} from \"./app.helper\";\n// import { invoke } from \"../navigation\";\nimport { reroute } from \"../navigation/hijackLocation\";\n// const APPS = [];\nexport function getAppNames() {\n  return APPS.map((app) => {\n    return app.name;\n  });\n}\nexport const APPS = [];\nexport function getRawApps() {\n  return [...APPS];\n}\n/**\n * 注册微服务Application\n * @param {sting} appName\n * @param {function<promise>} loadFunction\n * @param {function <Boolean>} activeWhenFunction\n * @param {object} props\n * @return {promise}\n */\nexport function registerApplication(\n  appName,\n  loadFunction,\n  activeWhenFunction,\n  customProps = {}\n) {\n  if (!appName || typeof appName !== \"string\") {\n    throw new Error(`App name must be no-empty string`);\n  }\n  if (getAppNames().indexOf(appName) !== -1) {\n    throw new Error(\"There is already an app declared with name \" + appName);\n  }\n  if (typeof loadFunction !== \"function\") {\n    throw new Error(\"the application or load function is required\");\n  }\n  if (typeof customProps !== \"object\" || Array.isArray(customProps)) {\n    throw new Error(\"the customProps must be a pure object\");\n  }\n  if (typeof activeWhenFunction !== \"function\") {\n    throw new Error(\"the activityWhen must be a function\");\n  }\n\n  APPS.push({\n    name: appName,\n    loadApp: loadFunction,\n    activityWhen: activeWhenFunction,\n    status: NOT_LOADED,\n    customProps,\n    services: {},\n  });\n  // reroute();\n  // return invoke();\n}\n/**\n * 获取满足加载条件的app\n * 1、没有加载中断\n * 2、没有加载错误\n * 3、没有被加载过\n * 4、满足app.activityWhen()\n * @return {*[]}\n */\nexport function getAppsToload() {\n  let loadPromise = APPS.filter(notBroken)\n    .filter(notLoadError)\n    .filter(isnotLoad)\n    .filter(shouldBeActive);\n  return loadPromise;\n}\n/**\n * 获取满足加载条件的app\n * 1、没有加载中断\n * 2、没有加载错误\n * 3、已经加载过\n * 4、mouted的\n * 5、不满足app.activityWhen()\n * @return {*[]}\n */\nexport function getUnmountApps() {\n  return APPS.filter(notBroken)\n    .filter(isloaded)\n    .filter(isActive)\n    .filter(shouldnotBeActive);\n}\n/**\n * 获取满足加载条件的app\n * 1、没有加载中断\n * 2、没有加载错误\n * 3、加载过的\n * 4、没有被mounted\n * 5、满足app.activityWhen()\n * @return {*[]}\n * .filter(isloaded)\n */\nexport function getAppsToMount() {\n  return APPS.filter(notBroken)\n    .filter(notLoadError)\n    .filter(isnotActive)\n    .filter(shouldBeActive);\n}\nexport function getMountedApps() {\n  return APPS.filter(isActive).map((item) => item.name);\n}\n","const TIMEOUTS = {\n  bootstrap: {\n    milliseconds: 3000,\n    rejectWhenTimeout: false,\n  },\n  mount: {\n    milliseconds: 3000,\n    rejectWhenTimeout: false,\n  },\n  unmount: {\n    milliseconds: 3000,\n    rejectWhenTimeout: false,\n  },\n};\nexport function ensureTimeout(timeouts = {}) {\n  return Object.assign({}, timeouts, TIMEOUTS);\n}\nexport function reasonableTimeout(lifecyle, description, timeouts) {\n  return new Promise((resolve, reject) => {\n    let finish = false;\n    lifecyle\n      .then((data) => {\n        finish = true;\n        resolve(data);\n      })\n      .catch(() => {\n        finish = true;\n        reject();\n      });\n    setTimeout(() => {\n      if (finish) {\n        return;\n      }\n      let error = `${description} did not resolve or reject for ${timeouts.milliseconds} milliseconds`;\n      if (timeouts.rejectWhenTimeout) {\n        throw new Error(error);\n      } else {\n        console.log(error);\n      }\n    }, timeouts.milliseconds);\n  });\n}\n","/**\n *  生命周期 bootstrap\n    生命周期 mount\n    生命周期 unmount\n */\nexport const LIFECYLES = [\"bootstrap\", \"mount\", \"unmount\"];\nexport function smellLikePromise(p) {\n  if (p instanceof Promise) {\n    return true;\n  }\n  return (\n    typeof p === \"object\" &&\n    typeof p.then === \"function\" &&\n    typeof p.catch === \"function\"\n  );\n}\nexport function flattenLifecyleArray(lifecyles, description) {\n  if (!Array.isArray(lifecyles)) {\n    lifecyles = [lifecyles];\n  }\n  if (lifecyles.length === 0) {\n    lifecyles = [\n      () => {\n        Promise.resolve();\n      },\n    ];\n  }\n  return function (pros) {\n    return new Promise((resolve, reject) => {\n      function next(index) {\n        let fn = lifecyles[index](pros);\n        if (!smellLikePromise(fn)) {\n          reject(`${description} at index ${index} did not return a promise`);\n          return;\n        } else {\n          fn.then(() => {\n            if (index >= lifecyles.length - 1) {\n              resolve();\n            } else {\n              next(++index);\n            }\n          }).catch(reject);\n        }\n      }\n      next(0);\n    });\n  };\n}\nexport function getProps(app) {\n  return {\n    name: app.name,\n    ...app.customProps,\n  };\n}\n","import {\n  NOT_LOADED,\n  LOAD_ERROR,\n  LOAD_SOURCE_CODE,\n  NOT_BOOTSTRAPED,\n  SKIP_BECAUSE_BROKEN,\n} from \"../applications/app.helper\";\nimport { ensureTimeout } from \"../applications/timeout\";\nimport {\n  smellLikePromise,\n  LIFECYLES,\n  flattenLifecyleArray,\n  getProps,\n} from \"./helper\";\n\nexport function toLoadPromise(app) {\n  console.log(`load the ${app.name} current status is `, app.status);\n  console.log(tinySingleSpa.getRawApps());\n  if (app.status !== NOT_LOADED && app.status !== LOAD_ERROR) {\n    return Promise.resolve(app);\n  }\n  app.status = LOAD_SOURCE_CODE;\n  let loadPromise = app.loadApp(getProps(app));\n\n  if (!smellLikePromise(loadPromise)) {\n    app.status = SKIP_BECAUSE_BROKEN;\n    return Promise.reject(new Error(\"\"));\n  }\n  return loadPromise\n    .then((appConfig) => {\n      if (typeof appConfig !== \"object\") {\n        throw new Error(\"\");\n      }\n      console.log(\n        `load the ${app.name} completed, current status is `,\n        app.status\n      );\n      let errors = [];\n      LIFECYLES.forEach((lifecyle) => {\n        if (!appConfig[lifecyle]) {\n          errors.push(\n            `${lifecyle}:must be a function or function array not empty`\n          );\n        }\n      });\n      if (errors.length) {\n        app.status = SKIP_BECAUSE_BROKEN;\n        console.log(errors);\n        return;\n      }\n      app.status = NOT_BOOTSTRAPED;\n      app.bootstrap = flattenLifecyleArray(\n        appConfig.bootstrap,\n        `app:${app.name} bootsstrapping`\n      );\n      app.mount = flattenLifecyleArray(\n        appConfig.mount,\n        `app:${app.name} mountting`\n      );\n      app.unmount = flattenLifecyleArray(\n        appConfig.unmount,\n        `app:${app.name} unmountting`\n      );\n      app.timeouts = ensureTimeout(app.timeouts);\n      return app;\n    })\n    .catch((e) => {\n      app.status = LOAD_ERROR;\n      return app;\n    });\n}\n\n// export function toLoadPromise(app) {\n//   app = tinySingleSpa.getRawApps().find((item) => item.name === app.name);\n//   console.log(`load the ${app.name} current status is `, app.status);\n//   console.log(tinySingleSpa.getRawApps());\n//   if (app.status !== NOT_LOADED && app.status !== LOAD_ERROR) {\n//     return Promise.resolve(app);\n//   }\n//   app.status = LOAD_SOURCE_CODE;\n//   let loadPromise = app.loadApp(getProps(app));\n//   if (!smellLikePromise(loadPromise)) {\n//     app.status = SKIP_BECAUSE_BROKEN;\n//     return Promise.reject(new Error(\"\"));\n//   }\n//   return new Promise((resovle, reject) => {\n//     loadPromise\n//       .then((appConfig) => {\n//         if (typeof appConfig !== \"object\") {\n//           throw new Error(\"\");\n//         }\n//         console.log(\n//           `load the ${app.name} completed, current status is `,\n//           app.status\n//         );\n//         let errors = [];\n//         LIFECYLES.forEach((lifecyle) => {\n//           if (!appConfig[lifecyle]) {\n//             errors.push(\n//               `${lifecyle}:must be a function or function array not empty`\n//             );\n//           }\n//         });\n//         if (errors.length) {\n//           app.status = SKIP_BECAUSE_BROKEN;\n//           console.log(errors);\n//           reject(app);\n//           return;\n//         }\n//         app.status = NOT_BOOTSTRAPED;\n//         app.bootstrap = flattenLifecyleArray(\n//           appConfig.bootstrap,\n//           `app:${app.name} bootsstrapping`\n//         );\n//         app.mount = flattenLifecyleArray(\n//           appConfig.mount,\n//           `app:${app.name} mountting`\n//         );\n//         app.unmount = flattenLifecyleArray(\n//           appConfig.unmount,\n//           `app:${app.name} unmountting`\n//         );\n//         app.timeouts = ensureTimeout(app.timeouts);\n//         resovle(app);\n//         return app;\n//       })\n//       .catch((e) => {\n//         app.status = LOAD_ERROR;\n//         reject(app);\n//         return app;\n//       });\n//   });\n// }\n\n// function pro() {\n//   return new Promise((resolve, reject) => {\n//     setTimeout(() => {\n//       console.log(1);\n//       resolve(100);\n//     }, 1000);\n//   });\n// }\n// function test() {\n//   return pro().then((data) => {\n//     console.log(\"2\");\n//     return data + 100;\n//   });\n// }\n// test()\n//   .then((data) => {\n//     console.log(3);\n//     console.log(data);\n//     return data + 100;\n//   })\n//   .then((data) => {\n//     console.log(4);\n//     console.log(data);\n//     return data + 100;\n//   });\n","import {\n  MOUNTED,\n  NOT_MOUNTED,\n  UNMOUNTTING,\n  SKIP_BECAUSE_BROKEN,\n} from \"../applications/app.helper\";\nimport { reasonableTimeout } from \"../applications/timeout\";\nimport { getProps } from \"./helper\";\n\nexport function unmountPromise(app) {\n  console.log(`unmount the ${app.name} current status is `, app.status);\n  console.log(tinySingleSpa.getRawApps());\n  if (app.status !== MOUNTED) {\n    return Promise.resolve(app);\n  }\n  app.status = UNMOUNTTING;\n  // return reasonableTimeout(\n  //   app.unmount(getProps(app)),\n  //   `app: ${app.name} unmountting`,\n  //   app.timeouts.unmount\n  // )\n  return app\n    .unmount(getProps(app))\n    .then(() => {\n      app.status = NOT_MOUNTED;\n      return app;\n    })\n    .catch((e) => {\n      console.log(e);\n      app.status = SKIP_BECAUSE_BROKEN;\n      return app;\n    });\n}\n\n// export function unmountPromise(app) {\n//   console.log(`unmount the ${app.name} current status is `, app.status);\n//   console.log(tinySingleSpa.getRawApps());\n//   if (app.status !== MOUNTED) {\n//     return Promise.resolve(app);\n//   }\n//   app.status = UNMOUNTTING;\n//   // return reasonableTimeout(\n//   //   app.unmount(getProps(app)),\n//   //   `app: ${app.name} unmountting`,\n//   //   app.timeouts.unmount\n//   // )\n//   return new Promise((resovle, reject) => {\n//     app\n//       .unmount(getProps(app))\n//       .then(() => {\n//         app.status = NOT_MOUNTED;\n//         resovle();\n//         return app;\n//       })\n//       .catch((e) => {\n//         console.log(e);\n//         app.status = SKIP_BECAUSE_BROKEN;\n//         reject();\n//         return app;\n//       });\n//   });\n// }\n","import {\n  BOOTSTRAPPING,\n  NOT_BOOTSTRAPED,\n  SKIP_BECAUSE_BROKEN,\n  NOT_MOUNTED,\n} from \"../applications/app.helper\";\nimport { reasonableTimeout } from \"../applications/timeout\";\nimport { getProps } from \"./helper\";\n\nexport function toBootstrapPromise(app) {\n  console.log(`bootstrap the ${app.name} current status is `, app.status);\n  console.log(tinySingleSpa.getRawApps());\n\n  if (app.status !== NOT_BOOTSTRAPED) {\n    return Promise.resolve(app);\n  }\n  app.status = BOOTSTRAPPING;\n  // return reasonableTimeout(\n  //   app.bootstrap(getProps(app)),\n  //   `app: ${app.name} bootstrapping`,\n  //   app.timeouts.bootstrap\n  // )\n  return app\n    .bootstrap(getProps(app))\n    .then(() => {\n      app.status = NOT_MOUNTED;\n      return app;\n    })\n    .catch((e) => {\n      console.log(e);\n      app.status = SKIP_BECAUSE_BROKEN;\n      return app;\n    });\n}\n\n// export function toBootstrapPromise(app) {\n//   console.log(`bootstrap the ${app.name} current status is `, app.status);\n//   console.log(tinySingleSpa.getRawApps());\n//   if (app.status !== NOT_BOOTSTRAPED) {\n//     return Promise.resolve(app);\n//   }\n//   app.status = BOOTSTRAPPING;\n//   // return reasonableTimeout(\n//   //   app.bootstrap(getProps(app)),\n//   //   `app: ${app.name} bootstrapping`,\n//   //   app.timeouts.bootstrap\n//   // )\n//   return new Promise((resovle, reject) => {\n//     app\n//       .bootstrap(getProps(app))\n//       .then(() => {\n//         app.status = NOT_MOUNTED;\n//         resovle();\n//         return app;\n//       })\n//       .catch((e) => {\n//         console.log(e);\n//         app.status = SKIP_BECAUSE_BROKEN;\n//         reject();\n//         return app;\n//       });\n//   });\n// }\n","import {\n  MOUNTED,\n  MOUNTTING,\n  SKIP_BECAUSE_BROKEN,\n  NOT_MOUNTED,\n} from \"../applications/app.helper\";\nimport { reasonableTimeout } from \"../applications/timeout\";\nimport { getProps } from \"./helper\";\n\nexport function toMountPromise(app) {\n  console.log(`mount the ${app.name} current status is `, app.status);\n  console.log(tinySingleSpa.getRawApps());\n\n  if (app.status !== NOT_MOUNTED) {\n    return Promise.resolve(app);\n  }\n  app.status = MOUNTTING;\n  // return reasonableTimeout(\n  //   app.mount(getProps(app)),\n  //   `app: ${app.name} moutting`,\n  //   app.timeouts.mount\n  // )\n  return app\n    .mount(getProps(app))\n    .then(() => {\n      app.status = MOUNTED;\n      return app;\n    })\n    .catch((e) => {\n      console.log(e);\n      app.status = SKIP_BECAUSE_BROKEN;\n      return app;\n    });\n}\n// export function toMountPromise(app) {\n//   console.log(`mount the ${app.name} current status is `, app.status);\n//   console.log(tinySingleSpa.getRawApps());\n//   if (app.status !== NOT_MOUNTED) {\n//     return Promise.resolve(app);\n//   }\n//   app.status = MOUNTTING;\n//   // return reasonableTimeout(\n//   //   app.mount(getProps(app)),\n//   //   `app: ${app.name} moutting`,\n//   //   app.timeouts.mount\n//   // )\n//   return new Promise((resovle, reject) => {\n//     app\n//       .mount(getProps(app))\n//       .then(() => {\n//         app.status = MOUNTED;\n//         resovle();\n//         return app;\n//       })\n//       .catch((e) => {\n//         console.log(e);\n//         app.status = SKIP_BECAUSE_BROKEN;\n//         reject();\n//         return app;\n//       });\n//   });\n// }\n","import {\n  getAppsToload,\n  getUnmountApps,\n  getAppsToMount,\n  getMountedApps,\n} from \"../applications/app\";\nimport { isStart } from \"../start\";\nimport { toLoadPromise } from \"../lifecyles/load\";\nimport { unmountPromise } from \"../lifecyles/unmount\";\nimport { toBootstrapPromise } from \"../lifecyles/bootstrap\";\nimport { toMountPromise } from \"../lifecyles/mount\";\nimport { callCapturedEvents } from \"../navigation/hijackLocation\";\nlet loadAppUnderway = false;\nconst pendingPromise = [];\n\nexport function invoke(pendings = [], events) {\n  if (loadAppUnderway) {\n    // 添加到pendingPromise中等待执行\n    return new Promise((resolve, reject) => {\n      pendingPromise.push({ resolve, reject, events });\n    });\n  }\n  if (isStart()) {\n    performAppChanges();\n  } else {\n    loadApps();\n  }\n  // load app;\n  function loadApps() {\n    let promiseLoadApps = getAppsToload().map(toLoadPromise);\n    console.log(\"promiseLoadApps:\", promiseLoadApps);\n    Promise.all(promiseLoadApps)\n      .then(() => {\n        callAllLocationEvent();\n        return finish();\n      })\n      .catch((e) => {\n        callAllLocationEvent();\n        console.log(e);\n      });\n  }\n\n  // 启动app\n  function performAppChanges() {\n    // unmout app\n    let unmountApps = getUnmountApps();\n    console.log(\"unmountApps:\", unmountApps);\n    let unmountAppsPromise = Promise.all(unmountApps.map(unmountPromise));\n    // load app\n    // let loadApps = getAppsToload();\n    // console.log(\"loadApps:\", loadApps);\n    // let loadPromises = loadApps.map((app) => {\n    //   return toLoadPromise(app)\n    //     .then((app) => toBootstrapPromise(app))\n    //     .then(() => unmountAppsPromise)\n    //     .then(() => toMountPromise(app));\n    // });\n\n    // mount app\n    let mountApps = getAppsToMount();\n    console.log(\"mountApps:\", mountApps);\n    // mountApps = mountApps.filter((app) => loadApps.indexOf(app) === -1);\n    let mountPromise = mountApps.map((app) => {\n      return (\n        toLoadPromise(app)\n          .then((app) => toBootstrapPromise(app))\n          // .then(() => unmountAppsPromise)\n          .then((app) => toMountPromise(app))\n      );\n    });\n    return unmountAppsPromise.then(\n      () => {\n        // let loadAndMountPromise = mountPromise;\n        // console.log(\"loadAndMountPromise:\", loadAndMountPromise);\n        return Promise.all(mountPromise).then(\n          () => {\n            callAllLocationEvent();\n            finish();\n          },\n          (ex) => {\n            pendings && pendings.forEach((item) => item.reject(ex));\n            throw ex;\n          }\n        );\n      },\n      (e) => {\n        callAllLocationEvent();\n        console.log(e);\n        throw e;\n      }\n    );\n  }\n  function finish() {\n    let resoveValue = getMountedApps();\n    if (pendings) {\n      pendings.forEach((pend) => {\n        pend.resolve(resoveValue);\n      });\n    }\n    loadAppUnderway = false;\n    if (pendingPromise.length) {\n      let backUp = pendingPromise;\n      pendingPromise = [];\n      return invoke(backUp);\n    }\n    return resoveValue;\n  }\n  function callAllLocationEvent() {\n    pendings &&\n      pendings.length &&\n      pendings.forEach((pend) => {\n        pend.events && callCapturedEvents(pend.events);\n      });\n    events && callCapturedEvents(events);\n  }\n}\n","import { invoke } from \"./navigation\";\nlet startFlag = false;\nexport function start() {\n  if (!startFlag) {\n    startFlag = true;\n    return invoke();\n  }\n}\nexport function isStart() {\n  return startFlag;\n}\n"],"names":["NOT_LOADED","LOAD_SOURCE_CODE","NOT_BOOTSTRAPED","BOOTSTRAPPING","NOT_MOUNTED","MOUNTTING","MOUNTED","UNMOUNTTING","SKIP_BECAUSE_BROKEN","LOAD_ERROR","notBroken","app","status","notLoadError","isloaded","isnotLoad","shouldBeActive","activityWhen","window","location","error","console","log","shouldnotBeActive","isActive","isnotActive","HIJACK_EVENTS_NAME","EVENTPOOL","popstate","hashchange","reroute","invoke","arguments","addEventListener","originAddEventListener","originRemoveEventListener","removeEventListener","type","handler","test","indexof","push","apply","list","filter","han","originPushState","history","pushState","originReplacestate","replaceState","state","title","url","result","mockPopStateEvent","PopStateEvent","callCapturedEvents","events","Array","isArray","name","forEach","eventArgs","getAppNames","APPS","map","getRawApps","registerApplication","appName","loadFunction","activeWhenFunction","customProps","Error","indexOf","loadApp","services","getAppsToload","loadPromise","getUnmountApps","getAppsToMount","getMountedApps","item","TIMEOUTS","bootstrap","milliseconds","rejectWhenTimeout","mount","unmount","ensureTimeout","timeouts","Object","assign","LIFECYLES","smellLikePromise","p","Promise","then","catch","flattenLifecyleArray","lifecyles","description","length","pros","resolve","reject","next","index","fn","getProps","toLoadPromise","tinySingleSpa","appConfig","errors","lifecyle","e","unmountPromise","toBootstrapPromise","toMountPromise","loadAppUnderway","pendingPromise","pendings","isStart","performAppChanges","loadApps","promiseLoadApps","all","callAllLocationEvent","finish","unmountApps","unmountAppsPromise","mountApps","mountPromise","ex","resoveValue","pend","backUp","startFlag","start"],"mappings":"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SAAS,CAACzB,KADoB,EAE7B,OAAM5E,GAAG,CAACkD,IAAK,YAFc,CAAhC;EAIAlD,IAAAA,GAAG,CAAC6E,OAAJ,GAAcW,oBAAoB,CAChCa,SAAS,CAACxB,OADsB,EAE/B,OAAM7E,GAAG,CAACkD,IAAK,cAFgB,CAAlC;EAIAlD,IAAAA,GAAG,CAAC+E,QAAJ,GAAeD,aAAa,CAAC9E,GAAG,CAAC+E,QAAL,CAA5B;EACA,WAAO/E,GAAP;EACD,GArCI,EAsCJuF,KAtCI,CAsCGiB,CAAD,IAAO;EACZxG,IAAAA,GAAG,CAACC,MAAJ,GAAaH,UAAb;EACA,WAAOE,GAAP;EACD,GAzCI,CAAP;EA0CD;EAGD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;ECrJO,SAASyG,cAAT,CAAwBzG,GAAxB,EAA6B;EAClCU,EAAAA,OAAO,CAACC,GAAR,CAAa,eAAcX,GAAG,CAACkD,IAAK,qBAApC,EAA0DlD,GAAG,CAACC,MAA9D;EACAS,EAAAA,OAAO,CAACC,GAAR,CAAYyF,aAAa,CAAC5C,UAAd,EAAZ;;EACA,MAAIxD,GAAG,CAACC,MAAJ,KAAeN,OAAnB,EAA4B;EAC1B,WAAO0F,OAAO,CAACQ,OAAR,CAAgB7F,GAAhB,CAAP;EACD;;EACDA,EAAAA,GAAG,CAACC,MAAJ,GAAaL,WAAb,CANkC;EAQlC;EACA;EACA;EACA;;EACA,SAAOI,GAAG,CACP6E,OADI,CACIqB,QAAQ,CAAC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"}